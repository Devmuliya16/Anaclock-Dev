<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- font awsome -->
    <script src="https://kit.fontawesome.com/2687fb36d2.js" crossorigin="anonymous"></script>

    <title>News By Dev</title>


    <style>
      /*navigation bar  */
        .navbar{
          background-color:#9797ff;
          position: sticky;
          top: -50px;
          z-index: 2;
          box-shadow: 0px 2px 22px black;
          min-width: 315px;
        }
        .navbar a{
          font-size: 25px;
          font-weight: bold;
        }
        #dropbtn{
          float: left;
        }
        .navbar button{
          color: white;
          border-color: white;
        }
        .nav-left{
         display: flex;
         flex-wrap: wrap;
        }
        #news-container{
            margin: auto;
            width: 100%;
            min-width: 314px;
            display: flex;
            align-items: stretch;
            flex-wrap: wrap;
            justify-content: center;
            
        }
        .news_elements{
            display: block;
            width: 650px;
            margin: 10px;
           
        }
        .news_elements a{
           width: fit-content;
           border-radius: 5px;
           display: block;
           padding: 5px;
        }
        .cradits{
          background-color: black;
          color: white;
          box-shadow: 0px -2px 5px 0px black;
          min-width: 314px;
          position:static;
        }
    </style>

  </head>
  <body>
    <!-- the navigation bar -->
    <nav class="navbar navbar-light justify-content-between">
        <a>
            <i class="fa-solid fa-newspaper"></i>
            News by Dev
          </a>
          <div class="btn-group">
      <div class="nav-left">     
          <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="dropbtn">
            <i class="fa-solid fa-earth-americas"></i>
            Countries
          </button>
          <div class="dropdown-menu">
                <a class="dropdown-item" onclick="india()"><img src="https://flagicons.lipis.dev/flags/4x3/in.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">India</a>
                <a class="dropdown-item" onclick="russia()"><img src="https://flagicons.lipis.dev/flags/4x3/ru.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">Russia</a>
                <a class="dropdown-item" onclick="china()"><img src="https://flagicons.lipis.dev/flags/4x3/cn.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">China</a>
                <a class="dropdown-item" onclick="japan()"><img src="https://flagicons.lipis.dev/flags/4x3/jp.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">Japan</a>
                <a class="dropdown-item" onclick="uk()"><img src="https://flagicons.lipis.dev/flags/4x3/gb.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">UK</a>
                <a class="dropdown-item" onclick="canada()"><img src="https://flagicons.lipis.dev/flags/4x3/ca.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">Canada</a>
                <a class="dropdown-item" onclick="us()"><img src="https://flagicons.lipis.dev/flags/4x3/um.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">US</a>
                <a class="dropdown-item" onclick="australia()"><img src="https://flagicons.lipis.dev/flags/4x3/au.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">Australia</a>
                <a class="dropdown-item" onclick="france()"><img src="https://flagicons.lipis.dev/flags/4x3/fr.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">France</a>
                <a class="dropdown-item" onclick="germany()"><img src="https://flagicons.lipis.dev/flags/4x3/de.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">Germany</a>
                <a class="dropdown-item" onclick="israel()"><img src="https://flagicons.lipis.dev/flags/4x3/il.svg" style="width: 30px; margin-bottom:5px;margin-right: 5px;">Israel</a>
          </div>
            
        <input id='search-news'class="form-control mr-sm-2" type="search" placeholder="Search topic" aria-label="Search" style="flex-shrink: 0; width: 200px;">
        <button class="btn btn-outline-secondary" type="submit" onclick="searchthis()">
          <i class="fa-solid fa-magnifying-glass"></i> Search
        </button>
      </div>
      </nav>

    <!-- about page -->
    <h1 id="about-page">
      <span class="badge badge-secondary">
        <i class="fa-solid fa-arrow-trend-up"></i>  News in trend</span>
      <span class="badge badge-secondary" id="count">India</span>
    </h1>

    <!-- news -->
    <div id="news-container">

     

    </div>

    <!-- cradits -->
    <div class="cradits">
      <h6>created by Dev <br> @2022</h6>
    </div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- local js -->
    <script>
        //my api to news api
//d651625361834d45983c15309f86b986 mxforlogin
//0728bb422eda4d8ebc9ddd52fcaee104 mygallary
const api = '0728bb422eda4d8ebc9ddd52fcaee104';
//alt https://cdn.pixabay.com/photo/2017/06/26/19/03/news-2444778_640.jpg
let country='India';
localStorage.setItem('country', 'in');
call();
function india() {
  localStorage.setItem('country', 'in');
  country = 'India';
  call();
}
function russia() {
  localStorage.setItem('country', 'ru');
  country = 'Russia';
  call();
}
function china() {
  localStorage.setItem('country', 'cn');
  country = 'China';
  call();
}
function japan() {
  localStorage.setItem('country', 'jp');
  country = 'Japan';
  call();
}
function uk() {
  localStorage.setItem('country', 'gb');
  country = 'U.K.';
  call();
}
function us() {
  country = 'U.S.';
  localStorage.setItem('country', 'us');
  call();
}
function israel() {
  country = 'Israel';
  localStorage.setItem('country', 'il');
  call();
}
function france() {
  country = 'France';
  localStorage.setItem('country', 'fr');
  call();
}
function germany() {
  country = 'Germany';
  localStorage.setItem('country', 'de');
  call();
}
function australia() {
  country = 'Australia';
  localStorage.setItem('country', 'au');
  call();
}
function canada() {
  country = 'Canada';
  localStorage.setItem('country', 'ca');
  call();
}

//getting the data (here api file) which is hosted on server by XML request 
//creating XHR object
function call() {
  document.getElementById('count').innerHTML=`${country}`;

  let xhr = new XMLHttpRequest;

  xhr.open('GET', `https://newsapi.org/v2/top-headlines?country=${localStorage.getItem('country')}&apiKey=${api}`, true);

  //when the request is completed
  xhr.onload = function () {
    if (this.status == 200) {
      //here the this.responcetext will provide the string which is not usable because we want api
      //so we will json.parse it
      let news_array = JSON.parse(this.responseText);
      let news = news_array.articles;
      console.log(news);

      //casting the news to the webpage
      let container = document.getElementById('news-container');
      container.innerHTML = '';
      news.forEach((element) => {
        let elem = document.createElement('div');
        elem.className = 'news_elements';
        elem.innerHTML = `
                <div class="card">
                <img class="card-img-top" src="${element.urlToImage}" alt="image did not found" onerror=this.src="https://cdn.pixabay.com/photo/2017/06/26/19/03/news-2444778_640.jpg">
                <div class="card-body">
                <h2 class="card-title">${element.title}</h2>
                <p class="card-text">${element.content}</p>
                <span class="badge badge-secondary">${element.publishedAt}</span>
                <span class="badge badge-secondary">@${element.source.name}</span>
                <a href="${element.url}" target="_blank" class="btn btn-primary">Read more</a>
                  </div>
                  </div>
                  `;
        container.appendChild(elem);
      });
    }
  }
  //sending the request
  xhr.send();
}


//making new xml request for searchbar
let searcharr;
let searchcontent;

function searchthis() {
  console.log('clicked');
  searchcontent = document.getElementById('search-news').value;
  console.log(searchcontent);
  
  let xhr2 = new XMLHttpRequest;
  xhr2.open('GET', `https://newsapi.org/v2/everything?q=${searchcontent}&apiKey=${api}`, true);
  console.log(searchcontent);
  
  xhr2.onload = function () {
    
    if (this.status == 200 && searchcontent != '') {
      console.log(searchcontent);
      
      searcharr = JSON.parse(this.responseText);
      console.log(searcharr);
      let container = document.getElementById('news-container');
      container.innerHTML = '';


      searcharr.articles.forEach((element) => {
        console.log(element);
        
        let elem = document.createElement('div');
        elem.className = 'news_elements';
        elem.innerHTML = `
              <div class="card">
              <div class="card-body">
                  <h2 class="card-title">${element.title}</h2>
                  <p class="card-text">${element.content}</p>
                  <span class="badge badge-secondary">${element.publishedAt}</span>
                  <a href="${element.url}" class="btn btn-primary">Read more</a>
                </div>
                </div>
              `;
        container.appendChild(elem);
      });

      document.getElementById('about-page').innerHTML = `
            <span class="badge badge-secondary">
            <i class="fa-solid fa-magnifying-glass"></i> ${searchcontent}
            </span>
            <span class="badge badge-secondary">showing ${searcharr.articles.length} results</span>`;

    }
    else
      console.log('error while loading');
  }

  xhr2.send();
}

    </script>
  </body>
</html>
